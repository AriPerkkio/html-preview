import{S as j,i as B,s as L,e as w,t as R,c as I,a as T,h as S,d as h,g as k,J as E,L as q,K as Q,k as A,m as M,b as C,M as Z,N as x,v as de,O as U,l as ee,w as W,x as J,y as G,P as H,q as $,o as P,B as z,n as le,Q as ce,p as fe,R as ue,T as F,U as _e,V as me,j as he,W as pe}from"../chunks/vendor-f9d32276.js";import{_ as ge,b as te}from"../chunks/paths-fb6b994c.js";function oe(n){let e,i,r,s;return{c(){e=w("button"),i=R("Remove editor")},l(o){e=I(o,"BUTTON",{});var t=T(e);i=S(t,"Remove editor"),t.forEach(h)},m(o,t){k(o,e,t),E(e,i),r||(s=q(e,"click",n[3]),r=!0)},p:Q,d(o){o&&h(e),r=!1,s()}}}function be(n){let e,i,r,s=!n[1]&&oe(n);return{c(){s&&s.c(),e=A(),i=w("div"),r=w("textarea"),this.h()},l(o){s&&s.l(o),e=M(o),i=I(o,"DIV",{class:!0});var t=T(i);r=I(t,"TEXTAREA",{class:!0}),T(r).forEach(h),t.forEach(h),this.h()},h(){r.value=n[0],C(r,"class","svelte-1awo5ji"),C(i,"class","codemirror-container svelte-1awo5ji"),Z(i,"active",n[1])},m(o,t){s&&s.m(o,t),k(o,e,t),k(o,i,t),E(i,r),n[5](r)},p(o,[t]){o[1]?s&&(s.d(1),s=null):s?s.p(o,t):(s=oe(o),s.c(),s.m(e.parentNode,e)),t&1&&(r.value=o[0]),t&2&&Z(i,"active",o[1])},i:Q,o:Q,d(o){s&&s.d(o),o&&h(e),o&&h(i),n[5](null)}}}function ve(n,e,i){const r=x();let{code:s=""}=e,{editorId:o}=e,{active:t=!1}=e,c;de(async()=>{let m=await ge(()=>import("../chunks/codemirror-f605f246.js"),["chunks/codemirror-f605f246.js","assets/codemirror-6f45da0e.css"]);await d(m.default)});async function d(m){if(!c)throw new Error("Missing ref to textarea");const y=m.fromTextArea(c,{lineNumbers:!0,lineWrapping:!0,mode:"htmlmixed",autoCloseBrackets:!0,autoCloseTags:!0,value:s});y.on("change",f=>{i(0,s=f.getValue()),r("change",{value:s,editorId:o})}),y.setValue(s)}function b(){r("remove",{editorId:o})}function _(m){U[m?"unshift":"push"](()=>{c=m,i(2,c)})}return n.$$set=m=>{"code"in m&&i(0,s=m.code),"editorId"in m&&i(4,o=m.editorId),"active"in m&&i(1,t=m.active)},n.$$.update=()=>{n.$$.dirty&19&&t&&r("change",{value:s,editorId:o})},[s,t,c,b,o,_]}class re extends j{constructor(e){super();B(this,e,ve,be,L,{code:0,editorId:4,active:1})}}function ne(n,e,i){const r=n.slice();return r[9]=e[i],r[10]=e,r[11]=i,r}function ie(n,e){let i,r,s,o;function t(d){e[6](d,e[9])}let c={active:e[9].id===e[1],editorId:e[9].id};return e[9].code!==void 0&&(c.code=e[9].code),r=new re({props:c}),U.push(()=>F(r,"code",t)),r.$on("change",e[5]),r.$on("remove",e[3]),{key:n,first:null,c(){i=ee(),W(r.$$.fragment),this.h()},l(d){i=ee(),J(r.$$.fragment,d),this.h()},h(){this.first=i},m(d,b){k(d,i,b),G(r,d,b),o=!0},p(d,b){e=d;const _={};b&3&&(_.active=e[9].id===e[1]),b&1&&(_.editorId=e[9].id),!s&&b&1&&(s=!0,_.code=e[9].code,H(()=>s=!1)),r.$set(_)},i(d){o||($(r.$$.fragment,d),o=!0)},o(d){P(r.$$.fragment,d),o=!1},d(d){d&&h(i),z(r,d)}}}function ye(n){let e,i,r,s,o,t,c,d=[],b=new Map,_,m,y,f=n[0];const u=a=>a[9].id;for(let a=0;a<f.length;a+=1){let l=ne(n,f,a),p=u(l);b.set(p,d[a]=ie(p,l))}return{c(){e=w("button"),i=R("Next state"),r=A(),s=w("button"),o=R("Add editor"),t=A(),c=w("div");for(let a=0;a<d.length;a+=1)d[a].c()},l(a){e=I(a,"BUTTON",{});var l=T(e);i=S(l,"Next state"),l.forEach(h),r=M(a),s=I(a,"BUTTON",{});var p=T(s);o=S(p,"Add editor"),p.forEach(h),t=M(a),c=I(a,"DIV",{});var v=T(c);for(let V=0;V<d.length;V+=1)d[V].l(v);v.forEach(h)},m(a,l){k(a,e,l),E(e,i),k(a,r,l),k(a,s,l),E(s,o),k(a,t,l),k(a,c,l);for(let p=0;p<d.length;p+=1)d[p].m(c,null);_=!0,m||(y=[q(e,"click",n[4]),q(s,"click",n[2])],m=!0)},p(a,[l]){l&43&&(f=a[0],le(),d=ce(d,l,u,1,a,f,b,c,_e,ie,null,ne),fe())},i(a){if(!_){for(let l=0;l<f.length;l+=1)$(d[l]);_=!0}},o(a){for(let l=0;l<d.length;l+=1)P(d[l]);_=!1},d(a){a&&h(e),a&&h(r),a&&h(s),a&&h(t),a&&h(c);for(let l=0;l<d.length;l+=1)d[l].d();m=!1,ue(y)}}}function Ee(n,e,i){var y;let r;const s=x();let{editors:o=[{id:1,code:""}]}=e,t=((y=o[0])==null?void 0:y.id)||1;function c(){i(0,o=[...o,{id:1+r,code:""}])}function d(f){const{editorId:u}=f.detail;i(0,o=o.filter(a=>a.id!==u))}function b(){const f=o.map(a=>a.id);if(t===r){i(1,t=Math.min(...f));return}const u=f.indexOf(t);i(1,t=f[1+u])}function _(f){const{value:u,editorId:a}=f.detail;a===t&&s("change",{value:u})}function m(f,u){n.$$.not_equal(u.code,f)&&(u.code=f,i(0,o))}return n.$$set=f=>{"editors"in f&&i(0,o=f.editors)},n.$$.update=()=>{n.$$.dirty&1&&(r=Math.max(...o.map(f=>f.id)))},[o,t,c,d,b,_,m]}class ke extends j{constructor(e){super();B(this,e,Ee,ye,L,{editors:0})}}function we(n){let e,i,r;function s(t){n[1](t)}let o={editorId:0};return n[0]!==void 0&&(o.code=n[0]),e=new re({props:o}),U.push(()=>F(e,"code",s)),e.$on("change",n[2]),{c(){W(e.$$.fragment)},l(t){J(e.$$.fragment,t)},m(t,c){G(e,t,c),r=!0},p(t,[c]){const d={};!i&&c&1&&(i=!0,d.code=t[0],H(()=>i=!1)),e.$set(d)},i(t){r||($(e.$$.fragment,t),r=!0)},o(t){P(e.$$.fragment,t),r=!1},d(t){z(e,t)}}}function Ie(n,e,i){let{code:r=""}=e;function s(t){r=t,i(0,r)}function o(t){me.call(this,n,t)}return n.$$set=t=>{"code"in t&&i(0,r=t.code)},[r,s,o]}class Te extends j{constructor(e){super();B(this,e,Ie,we,L,{code:0})}}function se(n){let e,i,r,s,o;return{c(){e=w("p"),i=R("TODO copy button here"),r=A(),s=w("a"),o=R(n[1]),this.h()},l(t){e=I(t,"P",{});var c=T(e);i=S(c,"TODO copy button here"),c.forEach(h),r=M(t),s=I(t,"A",{href:!0});var d=T(s);o=S(d,n[1]),d.forEach(h),this.h()},h(){C(s,"href",n[1])},m(t,c){k(t,e,c),E(e,i),k(t,r,c),k(t,s,c),E(s,o)},p(t,c){c&2&&he(o,t[1]),c&2&&C(s,"href",t[1])},d(t){t&&h(e),t&&h(r),t&&h(s)}}}function Ne(n){let e,i,r,s,o,t,c,d,b,_,m,y,f,u,a,l,p,v=n[1]&&se(n);function V(g){n[8](g)}let X={};n[3]!==void 0&&(X.code=n[3]),_=new Te({props:X}),U.push(()=>F(_,"code",V)),_.$on("change",n[5]);function ae(g){n[9](g)}let Y={};return n[2]!==void 0&&(Y.editors=n[2]),f=new ke({props:Y}),U.push(()=>F(f,"editors",ae)),f.$on("change",n[4]),{c(){e=w("div"),i=w("iframe"),s=A(),o=w("div"),t=w("button"),c=R("Export"),d=A(),v&&v.c(),b=A(),W(_.$$.fragment),y=A(),W(f.$$.fragment),this.h()},l(g){e=I(g,"DIV",{class:!0});var O=T(e);i=I(O,"IFRAME",{security:!0,src:!0,title:!0}),T(i).forEach(h),s=M(O),o=I(O,"DIV",{});var N=T(o);t=I(N,"BUTTON",{class:!0});var D=T(t);c=S(D,"Export"),D.forEach(h),d=M(N),v&&v.l(N),b=M(N),J(_.$$.fragment,N),y=M(N),J(f.$$.fragment,N),N.forEach(h),O.forEach(h),this.h()},h(){C(i,"security","restricted"),pe(i.src,r=""+(te+"/sandbox"))||C(i,"src",r),C(i,"title","Sandbox"),C(t,"class","export-btn svelte-beehw1"),C(e,"class","wrapper svelte-beehw1")},m(g,O){k(g,e,O),E(e,i),n[7](i),E(e,s),E(e,o),E(o,t),E(t,c),E(o,d),v&&v.m(o,null),E(o,b),G(_,o,null),E(o,y),G(f,o,null),a=!0,l||(p=q(t,"click",n[6]),l=!0)},p(g,[O]){g[1]?v?v.p(g,O):(v=se(g),v.c(),v.m(o,b)):v&&(v.d(1),v=null);const N={};!m&&O&8&&(m=!0,N.code=g[3],H(()=>m=!1)),_.$set(N);const D={};!u&&O&4&&(u=!0,D.editors=g[2],H(()=>u=!1)),f.$set(D)},i(g){a||($(_.$$.fragment,g),$(f.$$.fragment,g),a=!0)},o(g){P(_.$$.fragment,g),P(f.$$.fragment,g),a=!1},d(g){g&&h(e),n[7](null),v&&v.d(),z(_),z(f),l=!1,p()}}}function Oe(n){return K(n,"id")&&typeof n.id=="number"&&K(n,"code")&&typeof n.code=="string"}function K(n,e){return n?e in n:!1}function Ce(n,e,i){const r={};let s,{editors:o,style:t}=_();function c(u){var l,p;const{value:a}=u.detail;(p=(l=r.sandbox)==null?void 0:l.contentWindow)==null||p.postMessage({type:"CONTENT_CHANGE",value:a})}function d(u){var l,p;const{value:a}=u.detail;(p=(l=r.sandbox)==null?void 0:l.contentWindow)==null||p.postMessage({type:"STYLE_CHANGE",value:a})}function b(){const u=btoa(JSON.stringify({editors:o,style:t})),a=new URL(te,window.location.origin);a.searchParams.set("code",encodeURIComponent(u)),window.history.pushState({},"",a),i(1,s=a.toString())}function _(){const u={editors:[{id:1,code:""}],style:`<style>
  
</style>`},a=new URLSearchParams(document.location.search).get("code");let l;if(a)try{const p=atob(decodeURIComponent(a));l=JSON.parse(p)}catch(p){console.error("Unable to parse url search parameters",p)}return K(l,"style")&&typeof l.style=="string"&&K(l,"editors")&&Array.isArray(l.editors)&&l.editors.every(Oe)?{style:l.style,editors:l.editors}:u}function m(u){U[u?"unshift":"push"](()=>{r.sandbox=u,i(0,r)})}function y(u){t=u,i(3,t)}function f(u){o=u,i(2,o)}return[r,s,o,t,c,d,b,m,y,f]}class Re extends j{constructor(e){super();B(this,e,Ce,Ne,L,{})}}export{Re as default};
