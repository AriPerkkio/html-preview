import{S as D,i as j,s as L,e as I,t as A,c as T,a as R,h as C,d as h,g as E,J as v,L as q,K as X,k as S,m as U,b as O,M as $,N as x,v as de,O as M,l as W,w as J,x as F,y as G,P as H,q as P,o as V,B as z,n as ce,Q as le,p as fe,R as ue,T as K,U as _e,V as me,j as he,W as pe}from"../chunks/vendor-f9d32276.js";import{_ as ge,b as ee}from"../chunks/paths-fb6b994c.js";function te(n){let e,o,i,s;return{c(){e=I("button"),o=A("Remove editor")},l(r){e=T(r,"BUTTON",{});var t=R(e);o=C(t,"Remove editor"),t.forEach(h)},m(r,t){E(r,e,t),v(e,o),i||(s=q(e,"click",n[3]),i=!0)},p:X,d(r){r&&h(e),i=!1,s()}}}function be(n){let e,o,i,s=!n[0]&&n[1]&&te(n);return{c(){s&&s.c(),e=S(),o=I("div"),i=I("textarea"),this.h()},l(r){s&&s.l(r),e=U(r),o=T(r,"DIV",{class:!0});var t=R(o);i=T(t,"TEXTAREA",{class:!0}),R(i).forEach(h),t.forEach(h),this.h()},h(){O(i,"class","svelte-1awo5ji"),O(o,"class","codemirror-container svelte-1awo5ji"),$(o,"active",n[0])},m(r,t){s&&s.m(r,t),E(r,e,t),E(r,o,t),v(o,i),n[6](i)},p(r,[t]){!r[0]&&r[1]?s?s.p(r,t):(s=te(r),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null),t&1&&$(o,"active",r[0])},i:X,o:X,d(r){s&&s.d(r),r&&h(e),r&&h(o),n[6](null)}}}function ve(n,e,o){const i=x();let{code:s=""}=e,{editorId:r}=e,{active:t=!1}=e,{canBeRemoved:d=!0}=e,f;de(async()=>{let l=await ge(()=>import("../chunks/codemirror-f605f246.js"),["chunks/codemirror-f605f246.js","assets/codemirror-6f45da0e.css"]);await m(l.default)});async function m(l){if(!f)throw new Error("Missing ref to textarea");const c=l.fromTextArea(f,{lineNumbers:!0,lineWrapping:!0,mode:"htmlmixed",autoCloseBrackets:!0,autoCloseTags:!0,value:s});c.on("change",p=>{o(4,s=p.getValue()),i("change",{value:s,editorId:r})}),c.setValue(s)}function _(){i("remove",{editorId:r})}function y(l){M[l?"unshift":"push"](()=>{f=l,o(2,f)})}return n.$$set=l=>{"code"in l&&o(4,s=l.code),"editorId"in l&&o(5,r=l.editorId),"active"in l&&o(0,t=l.active),"canBeRemoved"in l&&o(1,d=l.canBeRemoved)},n.$$.update=()=>{n.$$.dirty&49&&t&&i("change",{value:s,editorId:r})},[t,d,f,_,s,r,y]}class oe extends D{constructor(e){super();j(this,e,ve,be,L,{code:4,editorId:5,active:0,canBeRemoved:1})}}function re(n,e,o){const i=n.slice();return i[9]=e[o],i[10]=e,i[11]=o,i}function ne(n,e){let o,i,s,r;function t(f){e[6](f,e[9])}let d={active:e[9].id===e[1],editorId:e[9].id};return e[9].code!==void 0&&(d.code=e[9].code),i=new oe({props:d}),M.push(()=>K(i,"code",t)),i.$on("change",e[5]),i.$on("remove",e[3]),{key:n,first:null,c(){o=W(),J(i.$$.fragment),this.h()},l(f){o=W(),F(i.$$.fragment,f),this.h()},h(){this.first=o},m(f,m){E(f,o,m),G(i,f,m),r=!0},p(f,m){e=f;const _={};m&3&&(_.active=e[9].id===e[1]),m&1&&(_.editorId=e[9].id),!s&&m&1&&(s=!0,_.code=e[9].code,H(()=>s=!1)),i.$set(_)},i(f){r||(P(i.$$.fragment,f),r=!0)},o(f){V(i.$$.fragment,f),r=!1},d(f){f&&h(o),z(i,f)}}}function ye(n){let e,o,i,s,r,t,d=[],f=new Map,m,_,y,l,c=n[0];const p=a=>a[9].id;for(let a=0;a<c.length;a+=1){let u=re(n,c,a),k=p(u);f.set(k,d[a]=ne(k,u))}return{c(){e=I("button"),o=A("Next state"),i=S(),s=I("button"),r=A("Add editor"),t=S();for(let a=0;a<d.length;a+=1)d[a].c();m=W()},l(a){e=T(a,"BUTTON",{});var u=R(e);o=C(u,"Next state"),u.forEach(h),i=U(a),s=T(a,"BUTTON",{});var k=R(s);r=C(k,"Add editor"),k.forEach(h),t=U(a);for(let b=0;b<d.length;b+=1)d[b].l(a);m=W()},m(a,u){E(a,e,u),v(e,o),E(a,i,u),E(a,s,u),v(s,r),E(a,t,u);for(let k=0;k<d.length;k+=1)d[k].m(a,u);E(a,m,u),_=!0,y||(l=[q(e,"click",n[4]),q(s,"click",n[2])],y=!0)},p(a,[u]){u&43&&(c=a[0],ce(),d=le(d,u,p,1,a,c,f,m.parentNode,_e,ne,m,re),fe())},i(a){if(!_){for(let u=0;u<c.length;u+=1)P(d[u]);_=!0}},o(a){for(let u=0;u<d.length;u+=1)V(d[u]);_=!1},d(a){a&&h(e),a&&h(i),a&&h(s),a&&h(t);for(let u=0;u<d.length;u+=1)d[u].d(a);a&&h(m),y=!1,ue(l)}}}function Ee(n,e,o){var l;let i;const s=x();let{editors:r=[{id:1,code:""}]}=e,t=((l=r[0])==null?void 0:l.id)||1;function d(){var p;const c=((p=r.find(a=>a.id===i))==null?void 0:p.code)||"";o(0,r=[...r,{id:1+i,code:c}])}function f(c){const{editorId:p}=c.detail;o(0,r=r.filter(a=>a.id!==p))}function m(){const c=r.map(a=>a.id);if(t===i){o(1,t=Math.min(...c));return}const p=c.indexOf(t);o(1,t=c[1+p])}function _(c){const{value:p,editorId:a}=c.detail;a===t&&s("change",{value:p})}function y(c,p){n.$$.not_equal(p.code,c)&&(p.code=c,o(0,r))}return n.$$set=c=>{"editors"in c&&o(0,r=c.editors)},n.$$.update=()=>{n.$$.dirty&1&&(i=Math.max(...r.map(c=>c.id)))},[r,t,d,f,m,_,y]}class ke extends D{constructor(e){super();j(this,e,Ee,ye,L,{editors:0})}}function we(n){let e,o,i;function s(t){n[1](t)}let r={editorId:0,canBeRemoved:!1};return n[0]!==void 0&&(r.code=n[0]),e=new oe({props:r}),M.push(()=>K(e,"code",s)),e.$on("change",n[2]),{c(){J(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,d){G(e,t,d),i=!0},p(t,[d]){const f={};!o&&d&1&&(o=!0,f.code=t[0],H(()=>o=!1)),e.$set(f)},i(t){i||(P(e.$$.fragment,t),i=!0)},o(t){V(e.$$.fragment,t),i=!1},d(t){z(e,t)}}}function Ie(n,e,o){let{code:i=""}=e;function s(t){i=t,o(0,i)}function r(t){me.call(this,n,t)}return n.$$set=t=>{"code"in t&&o(0,i=t.code)},[i,s,r]}class Te extends D{constructor(e){super();j(this,e,Ie,we,L,{code:0})}}function Re(){const n={editors:[{id:1,code:""}],style:`<style>
  
</style>`},e=new URLSearchParams(document.location.search).get("code");let o;if(e)try{const i=atob(decodeURIComponent(e));o=JSON.parse(i)}catch(i){console.error("Unable to parse url search parameters",i)}return Q(o,"style")&&typeof o.style=="string"&&Q(o,"editors")&&Array.isArray(o.editors)&&o.editors.every(Oe)?{style:o.style,editors:o.editors}:n}function Ne(n){const e=btoa(JSON.stringify(n)),o=new URL(ee,window.location.origin);return o.searchParams.set("code",encodeURIComponent(e)),o}function Oe(n){return Q(n,"id")&&typeof n.id=="number"&&Q(n,"code")&&typeof n.code=="string"}function Q(n,e){return n?e in n:!1}function ie(n){let e,o,i,s,r;return{c(){e=I("p"),o=A("TODO copy button here"),i=S(),s=I("a"),r=A(n[2]),this.h()},l(t){e=T(t,"P",{});var d=R(e);o=C(d,"TODO copy button here"),d.forEach(h),i=U(t),s=T(t,"A",{href:!0});var f=R(s);r=C(f,n[2]),f.forEach(h),this.h()},h(){O(s,"href",n[2])},m(t,d){E(t,e,d),v(e,o),E(t,i,d),E(t,s,d),v(s,r)},p(t,d){d&4&&he(r,t[2]),d&4&&O(s,"href",t[2])},d(t){t&&h(e),t&&h(i),t&&h(s)}}}function Se(n){let e,o,i,s,r,t,d,f,m,_,y,l,c,p,a,u,k,b=n[2]&&ie(n);function se(g){n[7](g)}let Y={};n[1]!==void 0&&(Y.code=n[1]),_=new Te({props:Y}),M.push(()=>K(_,"code",se));function ae(g){n[8](g)}let Z={};return n[3]!==void 0&&(Z.editors=n[3]),c=new ke({props:Z}),M.push(()=>K(c,"editors",ae)),c.$on("change",n[4]),{c(){e=I("div"),o=I("iframe"),s=S(),r=I("div"),t=I("button"),d=A("Export"),f=S(),b&&b.c(),m=S(),J(_.$$.fragment),l=S(),J(c.$$.fragment),this.h()},l(g){e=T(g,"DIV",{class:!0});var N=R(e);o=T(N,"IFRAME",{security:!0,src:!0,title:!0}),R(o).forEach(h),s=U(N),r=T(N,"DIV",{});var w=R(r);t=T(w,"BUTTON",{class:!0});var B=R(t);d=C(B,"Export"),B.forEach(h),f=U(w),b&&b.l(w),m=U(w),F(_.$$.fragment,w),l=U(w),F(c.$$.fragment,w),w.forEach(h),N.forEach(h),this.h()},h(){O(o,"security","restricted"),pe(o.src,i=""+(ee+"/sandbox"))||O(o,"src",i),O(o,"title","Sandbox"),O(t,"class","export-btn svelte-beehw1"),O(e,"class","wrapper svelte-beehw1")},m(g,N){E(g,e,N),v(e,o),n[6](o),v(e,s),v(e,r),v(r,t),v(t,d),v(r,f),b&&b.m(r,null),v(r,m),G(_,r,null),v(r,l),G(c,r,null),a=!0,u||(k=q(t,"click",n[5]),u=!0)},p(g,[N]){g[2]?b?b.p(g,N):(b=ie(g),b.c(),b.m(r,m)):b&&(b.d(1),b=null);const w={};!y&&N&2&&(y=!0,w.code=g[1],H(()=>y=!1)),_.$set(w);const B={};!p&&N&8&&(p=!0,B.editors=g[3],H(()=>p=!1)),c.$set(B)},i(g){a||(P(_.$$.fragment,g),P(c.$$.fragment,g),a=!0)},o(g){V(_.$$.fragment,g),V(c.$$.fragment,g),a=!1},d(g){g&&h(e),n[6](null),b&&b.d(),z(_),z(c),u=!1,k()}}}function Ue(n,e,o){const i={};let s,{editors:r,style:t}=Re();function d(l){var p,a;const{value:c}=l.detail;(a=(p=i.sandbox)==null?void 0:p.contentWindow)==null||a.postMessage({type:"CONTENT_CHANGE",value:c})}function f(){const l=Ne({style:t,editors:r});window.history.pushState({},"",l),o(2,s=l.toString())}function m(l){M[l?"unshift":"push"](()=>{i.sandbox=l,o(0,i)})}function _(l){t=l,o(1,t)}function y(l){r=l,o(3,r)}return n.$$.update=()=>{var l,c;n.$$.dirty&3&&((c=(l=i.sandbox)==null?void 0:l.contentWindow)==null||c.postMessage({type:"STYLE_CHANGE",value:t}))},[i,t,s,r,d,f,m,_,y]}class Me extends D{constructor(e){super();j(this,e,Ue,Se,L,{})}}export{Me as default};
