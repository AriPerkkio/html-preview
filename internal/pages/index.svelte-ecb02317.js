import{S as H,i as J,s as z,e as R,t as O,c as w,a as A,h as D,d as p,g as N,J as k,L as j,K as te,k as M,m as L,b as B,M as re,v as ne,N as ie,O as P,l as K,w as Q,x as X,y as Y,P as Z,q,o as W,B as $,n as fe,Q as _e,p as me,R as he,T as x,U as pe,V as ve,W as ge}from"../chunks/vendor-f7c0eacc.js";import{_ as be,b as se}from"../chunks/paths-fb6b994c.js";function ce(i){let e,t,r,s;return{c(){e=R("button"),t=O("Remove editor")},l(o){e=w(o,"BUTTON",{});var n=A(e);t=D(n,"Remove editor"),n.forEach(p)},m(o,n){N(o,e,n),k(e,t),r||(s=j(e,"click",i[4]),r=!0)},p:te,d(o){o&&p(e),r=!1,s()}}}function ye(i){let e,t,r,s=i[2]&&ce(i);return{c(){s&&s.c(),e=M(),t=R("div"),r=R("textarea"),this.h()},l(o){s&&s.l(o),e=L(o),t=w(o,"DIV",{class:!0});var n=A(t);r=w(n,"TEXTAREA",{class:!0}),A(r).forEach(p),n.forEach(p),this.h()},h(){r.value=i[0],B(r,"class","svelte-1awo5ji"),B(t,"class","codemirror-container svelte-1awo5ji"),re(t,"active",i[1])},m(o,n){s&&s.m(o,n),N(o,e,n),N(o,t,n),k(t,r),i[6](r)},p(o,[n]){o[2]?s?s.p(o,n):(s=ce(o),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null),n&1&&(r.value=o[0]),n&2&&re(t,"active",o[1])},i:te,o:te,d(o){s&&s.d(o),o&&p(e),o&&p(t),i[6](null)}}}function Ee(i,e,t){let{code:r=""}=e,{editorId:s}=e,{active:o=!1}=e,{canBeRemoved:n=!0}=e,d;ne(async()=>{if(!d)throw new Error("Missing ref to textarea");const{default:_}=await be(()=>import("../chunks/codemirror-f605f246.js"),["chunks/codemirror-f605f246.js","assets/codemirror-6f45da0e.css"]);_.fromTextArea(d,{lineNumbers:!0,lineWrapping:!0,mode:"htmlmixed",autoCloseBrackets:!0,autoCloseTags:!0,value:r}).on("change",a=>{t(0,r=a.getValue()),l("change",{value:r,editorId:s})})});const l=ie();function h(){l("remove",{editorId:s})}function v(_){P[_?"unshift":"push"](()=>{d=_,t(3,d)})}return i.$$set=_=>{"code"in _&&t(0,r=_.code),"editorId"in _&&t(5,s=_.editorId),"active"in _&&t(1,o=_.active),"canBeRemoved"in _&&t(2,n=_.canBeRemoved)},i.$$.update=()=>{i.$$.dirty&35&&o&&l("change",{value:r,editorId:s})},[r,o,n,d,h,s,v]}class ae extends H{constructor(e){super();J(this,e,Ee,ye,z,{code:0,editorId:5,active:1,canBeRemoved:2})}}function de(i,e,t){const r=i.slice();return r[11]=e[t],r[12]=e,r[13]=t,r}function le(i,e){let t,r,s,o;function n(l){e[7](l,e[11])}let d={canBeRemoved:e[11].id!==F,active:e[11].id===e[1],editorId:e[11].id};return e[11].code!==void 0&&(d.code=e[11].code),r=new ae({props:d}),P.push(()=>x(r,"code",n)),r.$on("change",e[6]),r.$on("remove",e[3]),{key:i,first:null,c(){t=K(),Q(r.$$.fragment),this.h()},l(l){t=K(),X(r.$$.fragment,l),this.h()},h(){this.first=t},m(l,h){N(l,t,h),Y(r,l,h),o=!0},p(l,h){e=l;const v={};h&1&&(v.canBeRemoved=e[11].id!==F),h&3&&(v.active=e[11].id===e[1]),h&1&&(v.editorId=e[11].id),!s&&h&1&&(s=!0,v.code=e[11].code,Z(()=>s=!1)),r.$set(v)},i(l){o||(q(r.$$.fragment,l),o=!0)},o(l){W(r.$$.fragment,l),o=!1},d(l){l&&p(t),$(r,l)}}}function ke(i){let e,t,r,s,o,n,d,l,h,v,_,T,a=[],y=new Map,u,m,E,C,g=i[0];const G=c=>c[11].id;for(let c=0;c<g.length;c+=1){let f=de(i,g,c),U=G(f);y.set(U,a[c]=le(U,f))}return{c(){e=R("div"),t=R("label"),r=O("Loop states"),s=M(),o=R("input"),n=M(),d=R("button"),l=O("Next state"),h=M(),v=R("button"),_=O("Add editor"),T=M();for(let c=0;c<a.length;c+=1)a[c].c();u=K(),this.h()},l(c){e=w(c,"DIV",{});var f=A(e);t=w(f,"LABEL",{for:!0});var U=A(t);r=D(U,"Loop states"),U.forEach(p),s=L(f),o=w(f,"INPUT",{id:!0,type:!0}),f.forEach(p),n=L(c),d=w(c,"BUTTON",{});var b=A(d);l=D(b,"Next state"),b.forEach(p),h=L(c),v=w(c,"BUTTON",{});var S=A(v);_=D(S,"Add editor"),S.forEach(p),T=L(c);for(let I=0;I<a.length;I+=1)a[I].l(c);u=K(),this.h()},h(){B(t,"for","state-cycle"),B(o,"id","state-cycle"),B(o,"type","checkbox")},m(c,f){N(c,e,f),k(e,t),k(t,r),k(e,s),k(e,o),N(c,n,f),N(c,d,f),k(d,l),N(c,h,f),N(c,v,f),k(v,_),N(c,T,f);for(let U=0;U<a.length;U+=1)a[U].m(c,f);N(c,u,f),m=!0,E||(C=[j(o,"change",i[5]),j(d,"click",i[4]),j(v,"click",i[2])],E=!0)},p(c,[f]){f&75&&(g=c[0],fe(),a=_e(a,f,G,1,c,g,y,u.parentNode,pe,le,u,de),me())},i(c){if(!m){for(let f=0;f<g.length;f+=1)q(a[f]);m=!0}},o(c){for(let f=0;f<a.length;f+=1)W(a[f]);m=!1},d(c){c&&p(e),c&&p(n),c&&p(d),c&&p(h),c&&p(v),c&&p(T);for(let f=0;f<a.length;f+=1)a[f].d(c);c&&p(u),E=!1,he(C)}}}const F=1;function Ie(i,e,t){var y;let r;const s=ie();let{editors:o=[{id:F,code:""}]}=e,n=((y=o[0])==null?void 0:y.id)||F,d;function l(){var m;const u=((m=o.find(E=>E.id===r))==null?void 0:m.code)||"";t(0,o=[...o,{id:1+r,code:u}])}function h(u){const{editorId:m}=u.detail;if(n===m){const E=o.findIndex(g=>g.id===m),C=o[E-1];t(1,n=(C==null?void 0:C.id)||F)}t(0,o=o.filter(E=>E.id!==m))}function v(){const u=o.map(E=>E.id);if(n===r){t(1,n=Math.min(...u));return}const m=u.indexOf(n);t(1,n=u[1+m])}function _(u){if(!u.currentTarget.checked){d==null||d(),d=null;return}const m=setInterval(v,3e3);d=()=>clearInterval(m)}function T(u){const{value:m,editorId:E}=u.detail;E===n&&s("change",{value:m})}function a(u,m){i.$$.not_equal(m.code,u)&&(m.code=u,t(0,o))}return i.$$set=u=>{"editors"in u&&t(0,o=u.editors)},i.$$.update=()=>{i.$$.dirty&1&&(r=Math.max(...o.map(u=>u.id)))},[o,n,l,h,v,_,T,a]}class Te extends H{constructor(e){super();J(this,e,Ie,ke,z,{editors:0})}}function Re(i){let e,t,r;function s(n){i[1](n)}let o={editorId:0,canBeRemoved:!1};return i[0]!==void 0&&(o.code=i[0]),e=new ae({props:o}),P.push(()=>x(e,"code",s)),e.$on("change",i[2]),{c(){Q(e.$$.fragment)},l(n){X(e.$$.fragment,n)},m(n,d){Y(e,n,d),r=!0},p(n,[d]){const l={};!t&&d&1&&(t=!0,l.code=n[0],Z(()=>t=!1)),e.$set(l)},i(n){r||(q(e.$$.fragment,n),r=!0)},o(n){W(e.$$.fragment,n),r=!1},d(n){$(e,n)}}}function we(i,e,t){let{code:r=""}=e;function s(n){r=n,t(0,r)}function o(n){ve.call(this,i,n)}return i.$$set=n=>{"code"in n&&t(0,r=n.code)},[r,s,o]}class Ne extends H{constructor(e){super();J(this,e,we,Re,z,{code:0})}}function Ue(){const i={editors:[{id:1,code:""}],style:`<style>
  
</style>`},e=new URLSearchParams(document.location.search).get("code");let t;if(e)try{const r=atob(decodeURIComponent(e));t=JSON.parse(r)}catch(r){console.error("Unable to parse url search parameters",r)}return ee(t,"style")&&typeof t.style=="string"&&ee(t,"editors")&&Array.isArray(t.editors)&&t.editors.every(Ae)?{style:t.style,editors:t.editors}:i}function Se(i){const e=btoa(JSON.stringify(i)),t=new URL(se,window.location.origin);return t.searchParams.set("code",encodeURIComponent(e)),t}function Ae(i){return ee(i,"id")&&typeof i.id=="number"&&ee(i,"code")&&typeof i.code=="string"}function ee(i,e){return i?e in i:!1}function ue(i){let e;return{c(){e=O("URL copied to clipboard!")},l(t){e=D(t,"URL copied to clipboard!")},m(t,r){N(t,e,r)},d(t){t&&p(e)}}}function Be(i){let e,t,r,s,o,n,d,l,h,v,_,T,a,y,u,m,E,C,g=i[2]&&ue();function G(b){i[7](b)}let c={};i[0]!==void 0&&(c.code=i[0]),_=new Ne({props:c}),P.push(()=>x(_,"code",G));function f(b){i[8](b)}let U={};return i[3]!==void 0&&(U.editors=i[3]),y=new Te({props:U}),P.push(()=>x(y,"editors",f)),y.$on("change",i[4]),{c(){e=R("div"),t=R("iframe"),s=M(),o=R("div"),n=R("button"),d=O("Export"),l=M(),h=R("span"),g&&g.c(),v=M(),Q(_.$$.fragment),a=M(),Q(y.$$.fragment),this.h()},l(b){e=w(b,"DIV",{class:!0});var S=A(e);t=w(S,"IFRAME",{security:!0,src:!0,title:!0}),A(t).forEach(p),s=L(S),o=w(S,"DIV",{});var I=A(o);n=w(I,"BUTTON",{class:!0});var V=A(n);d=D(V,"Export"),V.forEach(p),l=L(I),h=w(I,"SPAN",{"aria-live":!0});var oe=A(h);g&&g.l(oe),oe.forEach(p),v=L(I),X(_.$$.fragment,I),a=L(I),X(y.$$.fragment,I),I.forEach(p),S.forEach(p),this.h()},h(){B(t,"security","restricted"),ge(t.src,r=""+(se+"/sandbox"))||B(t,"src",r),B(t,"title","Sandbox"),B(n,"class","export-btn svelte-1d5ock9"),B(h,"aria-live","polite"),B(e,"class","wrapper svelte-1d5ock9")},m(b,S){N(b,e,S),k(e,t),i[6](t),k(e,s),k(e,o),k(o,n),k(n,d),k(o,l),k(o,h),g&&g.m(h,null),k(o,v),Y(_,o,null),k(o,a),Y(y,o,null),m=!0,E||(C=j(n,"click",i[5]),E=!0)},p(b,[S]){b[2]?g||(g=ue(),g.c(),g.m(h,null)):g&&(g.d(1),g=null);const I={};!T&&S&1&&(T=!0,I.code=b[0],Z(()=>T=!1)),_.$set(I);const V={};!u&&S&8&&(u=!0,V.editors=b[3],Z(()=>u=!1)),y.$set(V)},i(b){m||(q(_.$$.fragment,b),q(y.$$.fragment,b),m=!0)},o(b){W(_.$$.fragment,b),W(y.$$.fragment,b),m=!1},d(b){b&&p(e),i[6](null),g&&g.d(),$(_),$(y),E=!1,C()}}}function Ce(i,e,t){const r={};let s,{editors:o,style:n}=Ue();ne(()=>{d({type:"CONTENT_CHANGE",value:o[0].code})});function d(a,y=5){var m;const u=(m=r.sandbox)==null?void 0:m.contentWindow;u?u.postMessage(a):y>0&&setTimeout(()=>d(a,y-1),500)}function l(a){d({type:"CONTENT_CHANGE",value:a.detail.value})}function h(){const a=Se({style:n,editors:o});window.history.pushState({},"",a),t(2,s=a.toString()),navigator.clipboard.writeText(s).then(()=>{setTimeout(()=>{t(2,s="")},3e3)})}function v(a){P[a?"unshift":"push"](()=>{r.sandbox=a,t(1,r)})}function _(a){n=a,t(0,n)}function T(a){o=a,t(3,o)}return i.$$.update=()=>{i.$$.dirty&1&&d({type:"STYLE_CHANGE",value:n})},[n,r,s,o,l,h,v,_,T]}class Oe extends H{constructor(e){super();J(this,e,Ce,Be,z,{})}}export{Oe as default};
